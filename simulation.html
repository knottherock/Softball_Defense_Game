<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Softball Simulation</title>
  <style>
    body { font-family: Arial; padding: 20px; background: #f0f0f0; }
    .section { background: #fff; padding: 15px; margin-bottom: 20px; border-radius: 8px; }
    textarea, button { width: 100%; margin-top: 10px; padding: 8px; }
  </style>
</head>
<body>

  <div class="section">
    <h2>üßæ Game Situation</h2>
    <p id="gameStateText"></p>
    <button onclick="nextInning()">Next Inning</button>
    <button onclick="quitGame()">Quit to Position Select</button>
  </div>

  <div class="section">
    <h2>üéÆ Simulation</h2>
    <p id="hitResult"></p>
    <button onclick="simulateHit()">Simulate Hit</button>

    <h3>If ball is hit to YOU:</h3>
    <textarea id="primarySelf" placeholder="Primary action"></textarea>
    <textarea id="secondarySelf" placeholder="Secondary action"></textarea>

    <h3>If ball is hit to ANOTHER:</h3>
    <textarea id="primaryOther" placeholder="Primary action"></textarea>
    <textarea id="secondaryOther" placeholder="Secondary action"></textarea>

    <button onclick="submitPlay()">Submit Play</button>
  </div>

  <div class="section" id="summarySection" style="display:none;">
    <h2>üß† Feedback</h2>
    <p id="summaryOutput"></p>
    <p id="feedbackOutput"></p>
  </div>

  <script>
    const positions = ["P", "C", "1B", "2B", "SS", "3B", "LF", "CF", "RF"];
    const hitTypes = ["Grounder", "Line Drive", "Pop Fly"];
    let hitTo = "", hitType = "";
    let gameState = { inning: 1, outs: 0, runners: [], score: { home: 0, away: 0 } };

    const playerPos = localStorage.getItem("playerPosition");

    function updateGameState() {
      const { inning, outs, runners, score } = gameState;
      document.getElementById("gameStateText").innerText =
        `Inning: ${inning}, Outs: ${outs}, Runners on: ${runners.join(", ") || "None"}, Score: Home ${score.home} - Away ${score.away}`;
    }

    function simulateHit() {
      hitTo = positions[Math.floor(Math.random() * positions.length)];
      hitType = hitTypes[Math.floor(Math.random() * hitTypes.length)];
      document.getElementById("hitResult").innerText = `Ball hit to ${hitTo} (${hitType})`;
      document.getElementById("summarySection").style.display = "none";
    }

    function submitPlay() {
      const ps = document.getElementById("primarySelf").value;
      const ss = document.getElementById("secondarySelf").value;
      const po = document.getElementById("primaryOther").value;
      const so = document.getElementById("secondaryOther").value;

      const summary = `
        <strong>Position:</strong> ${playerPos}<br>
        <strong>Hit:</strong> ${hitTo} (${hitType})<br><br>
        <strong>‚û° If ball is hit to YOU:</strong><br>
        Primary: ${ps}<br>
        Secondary: ${ss}<br><br>
        <strong>‚û° If ball is hit to ANOTHER:</strong><br>
        Primary: ${po}<br>
        Secondary: ${so}
      `;
      document.getElementById("summaryOutput").innerHTML = summary;
      document.getElementById("feedbackOutput").innerText = generateFeedback(playerPos, hitTo, hitType, ps, ss, po, so);
      document.getElementById("summarySection").style.display = "block";
    }

    function generateFeedback(pos, hitTo, hitType, ps, ss, po, so) {
      if (pos === hitTo) {
        if (ps.toLowerCase().includes("throw") && ss.toLowerCase().includes("cover")) {
          return "‚úÖ Smart play: You fielded and ensured coverage.";
        } else {
          return "‚ö†Ô∏è Consider refining your throw or coverage strategy.";
        }
      } else {
        if (po.toLowerCase().includes("backup") && so.toLowerCase().includes("cover")) {
          return "‚úÖ Great awareness: You backed up and covered the vacated base.";
        } else {
          return "‚ö†Ô∏è You might want to anticipate movement and adjust your coverage.";
        }
      }
    }

    function nextInning() {
      gameState.inning += 1;
      gameState.outs = 0;
      gameState.runners = [];
      gameState.score = { home: 0, away: 0 };
      updateGameState();
      document.getElementById("summarySection").style.display = "none";
      document.getElementById("hitResult").innerText = "";
    }

    function quitGame() {
      localStorage.removeItem("playerPosition");
      window.location.href = "index.html";
    }

    updateGameState();
  </script>

</body>
</html>
